<!DOCTYPE html>
<html>
<head>
  <title>Club Attendance Scanner</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; text-align: center; }
    #reader { width: 300px; margin: auto; }
    #log { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Attendance Scanner</h1>
  <div id="reader"></div>
  <div id="log"></div>

  <script>
    // URL of your deployed Google Apps Script web app
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzpc3BDq0UoF54rKl8MjqCd13yTEFv_hAWtwIYoD6cYPXy-AC7ekqGOO--PR2I7FpcJ/exec'; // Replace YOUR_DEPLOYMENT_ID

    const logDiv = document.getElementById('log');
    const SCANNED_IDS = new Set();

    function logScan(data) {
      if (SCANNED_IDS.has(data)) return;
      SCANNED_IDS.add(data);

      const timestamp = new Date().toISOString();
      const entry = `Scanned ID: ${data} | Time: ${timestamp}`;
      logDiv.innerHTML = `<p>${entry}</p>` + logDiv.innerHTML;

      // Send scan data to Google Apps Script without needing OAuth
      fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors', // Apps Script exec allows no-cors for public scripts
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id: data, timestamp: timestamp })
      }).catch(err => console.error('Error sending data to server:', err));
    }

    // Initialize and start the camera scanner
    const scanner = new Html5Qrcode("reader");
    scanner.start(
      { facingMode: "environment" },
      { fps: 10, qrbox: 250 },
      (decodedText) => logScan(decodedText),
      (errorMessage) => {}
    ).catch(err => console.error("Camera error:", err));
  </script>
</body>
</html>
